<main class="container">
  <section class="item-header">

    <div class="d-flex justify-content-between align-items-center mb-4">

    <h1><%= @item.name %></h1>
        <%= link_to "Editer l'objet", edit_item_path(@item), class: "btn btn-outline-secondary" %>

    </div>
    <div class="meta">
      <%# <span>ü•á Supervendeur ¬∑ <a href="#">Bordeaux, France</a></span> %>
    </div>
  </section>


  <%# IMAGE GALLERY %>
  <% if @item.image.attached? %>
    <div class="gallery">
      <div class="">
        <%= cl_image_tag @item.image.key, class: "main-image object-fit-cover w-100" %>
      </div>
      <%# <div class="main-image"><img src="nimbus-main.jpg" alt="nimbus" /></div> %>
      <div class="thumbnails col-5">
        <%= cl_image_tag @item.image.key, class: ""  %>
        <%= cl_image_tag @item.image.key, class: "" %>
        <%= cl_image_tag @item.image.key, class: "" %>
        <%= cl_image_tag @item.image.key, class: "" %>
      </div>
    </div>
  <% end %>

  <%# FORMULAIRE %>

  <%# DESCRIPTION %>
  <div class="container2">
    <section class="item-info">
      <h2><%= @item.description %></h2>

<% if @item.reviews.any? %>
        <ul class="list-unstyled">
          <% total_rating = @item.reviews.sum(:rating) %>
          <% average_rating = total_rating / @item.reviews.count if @item.reviews.count > 0 %>
          <p>Note : <strong><%= average_rating %> ‚≠ê</strong></p>
<% end %>











      <div class="info-box"> ü™Ñ <%= @item.category.capitalize %> de <strong>niveau <%= @item.power %></strong>  </div>
      <% if @item.category == "chaudron" %>
        <div class="info-box">‚ú® Peut aussi servir √† faire une excellente soupe aux orties (avec ou sans sortil√®ges).</div>
      <% elsif @item.category == "balais" %>
        <div class="info-box">‚ú® Peut aussi servir √† enlever la poussi√®re</div>
      <% elsif @item.category == "baguette" %>
        <div class="info-box">‚ú® Peut aussi servir √† m√©langer le caf√©‚Ä¶ mais attention aux explosions.</div>
      <% elsif @item.category == "amulette" %>
        <div class="info-box">‚ú® Prot√®ge contre les mal√©dictions‚Ä¶ et les mauvais rencards.</div>
      <% elsif @item.category == "cape" %>
        <div class="info-box">‚ú® Peut aussi cacher une tenue douteuse en cas d'urgence fashion.</div>
      <% end %>

      <div class="description">
        <h3>Description</h3>
        <p><%= @item.long_description %></p>
      </div>

      <%# REVIEWS %>

      <div class="reviews">
        <h3 class="d-flex justify-content-between align-items-center ts-4">
          Reviews
          <%= link_to "Ajouter une review", new_item_review_path(@item), class: "text-decoration-none fs-6",  style: "color: #6f42c1;" %>
        </h3>
</div>


        <% if @item.reviews.any? %>
          <ul class="list-unstyled">
            <% total_rating = @item.reviews.sum(:rating) %>
            <% average_rating = total_rating / @item.reviews.count if @item.reviews.count > 0 %>
            

            <% @item.reviews.each do |review| %>
              <h5 class="font-weight-bold">
                <strong><%= review.user.name %> - <%= review.rating %> ‚≠ê</strong>
              </h5>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <p style="margin: 1;">
                  <%= review.content %>
                  <small> - Il y a <%= time_ago_in_words(review.created_at) %></small>
                </p>
                <% if review.user_id == current_user.id %>
                  <%= link_to "‚úñ", review_path(review),
                        data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this review?" },
                        class: "text-danger", style: "text-decoration: none; font-size: 1rem; margin-left: 1rem;" %>
                <% end %>
              </div>
            <% end %>
          </ul>
        <% else %>
          <p>No reviews yet</p>
        <% end %>

</section>

    <aside class="booking">

      <div class="price">¬£<%= @item.price.round %> / jour</div>

      <%# <span>‚≠ê <%= existing_rating.score %>
      <%# <a href="#">7 commentaires</a></span> %>

      <%= form_with url: new_item_reservation_path(@item), method: :get, local: true do %>
        <div class="form-group">
          <label for="startDate">Date de d√©but</label>
          <input type="date" name="start_date" class="form-control" id="startDate">
        </div>

        <div class="form-group">
          <label for="endDate">Date de fin</label>
          <input type="date" name="end_date" class="form-control" id="endDate">
        </div>

        <%= submit_tag "R√©server", class: "btn btn-primary" %>
      <% end %>


      <div class="summary"></div>
    </aside>

    <%# BOUTONS %>

    <%= link_to "Supprimer l'objet", item_path(@item), data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this item?" }, class: "btn btn-outline-danger" %>
  </div>

  <%# <% if @item.image.attached? %>
