<main class="container container-wide">
  <section class="item-header">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1><%= @item.name %></h1>
      <%= link_to "Editer l'objet", edit_item_path(@item), class: "btn btn-outline-secondary" %>
    </div>
    <div class="meta">
      <%# <span>ü•á Supervendeur ¬∑ <a href="#">Bordeaux, France</a></span> %>
    </div>
  </section>

  <% if @item.image.attached? %>
    <div class="gallery">
      <div>
        <%= cl_image_tag @item.image.key, class: "main-image object-fit-cover w-100" %>
      </div>
      <div class="thumbnails col-5">
        <%= cl_image_tag @item.image.key %>
        <%= cl_image_tag @item.image.key %>
        <%= cl_image_tag @item.image.key %>
        <%= cl_image_tag @item.image.key %>
      </div>
    </div>
  <% end %>

  <div class="item-layout mt-5">
    <!-- CONTENU PRINCIPAL -->
    <section class="item-info">
      <h2><%= @item.description %></h2>

      <% if @item.reviews.any? %>
        <% total_rating = @item.reviews.sum(:rating) %>
        <% average_rating = total_rating / @item.reviews.count.to_f %>
        <p>Note : <strong><%= average_rating.round(1) %> ‚≠ê</strong></p>
      <% end %>

      <div class="info-box">ü™Ñ <%= @item.category.capitalize %> de <strong>niveau <%= @item.power %></strong></div>

      <% case @item.category
         when "chaudron" %>
        <div class="info-box">‚ú® Peut aussi servir √† faire une excellente soupe aux orties (avec ou sans sortil√®ges).</div>
      <% when "balais" %>
        <div class="info-box">‚ú® Peut aussi servir √† enlever la poussi√®re</div>
      <% when "baguette" %>
        <div class="info-box">‚ú® Peut aussi servir √† m√©langer le caf√©‚Ä¶ mais attention aux explosions.</div>
      <% when "amulette" %>
        <div class="info-box">‚ú® Prot√®ge contre les mal√©dictions‚Ä¶ et les mauvais rencards.</div>
      <% when "cape" %>
        <div class="info-box">‚ú® Peut aussi cacher une tenue douteuse en cas d'urgence fashion.</div>
      <% end %>

      <div class="description mt-4">
        <h3>Description</h3>
        <p><%= @item.long_description %></p>
      </div>

      <div class="reviews mt-4">
        <h3 class="d-flex justify-content-between align-items-center">
          Reviews
          <%= link_to "Ajouter une review", new_item_review_path(@item), class: "text-decoration-none fs-6", style: "color: #6f42c1;" %>
        </h3>

        <% if @item.reviews.any? %>
          <ul class="list-unstyled">
            <% @item.reviews.each do |review| %>
              <li class="mb-3">
                <strong><%= review.user.name %> - <%= review.rating %> ‚≠ê</strong>
                <div class="d-flex justify-content-between align-items-center">
                  <p class="mb-1">
                    <%= review.content %>
                    <small> - Il y a <%= time_ago_in_words(review.created_at) %></small>
                  </p>
                  <% if review.user_id == current_user.id %>
                    <%= link_to "‚úñ", review_path(review), data: { turbo_method: :delete, turbo_confirm: "Supprimer cette review ?" }, class: "text-danger ms-3" %>
                  <% end %>
                </div>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p>Aucune review pour le moment.</p>
        <% end %>

        <%= link_to "Supprimer l'objet", item_path(@item), data: { turbo_method: :delete, turbo_confirm: "Supprimer cet objet ?" }, class: "btn btn-outline-danger mt-4" %>
      </div>
    </section>

    <!-- FORMULAIRE DE R√âSERVATION -->
    <aside class="booking">
      <div class="price mb-3">¬£<%= @item.price.round %> / jour</div>

      <%= form_with url: new_item_reservation_path(@item), method: :get, local: true, html: { class: "magic-form" } do %>
        <div class="form-group mb-3">
          <label for="startDate">Date de d√©but</label>
          <input type="date" name="start_date" class="form-control" id="startDate">
        </div>

        <div class="form-group mb-3">
          <label for="endDate">Date de fin</label>
          <input type="date" name="end_date" class="form-control" id="endDate">
        </div>

        <div class="form-actions">
          <%= submit_tag "‚ú® R√©server", class: "btn btn-primary w-100" %>
        </div>
      <% end %>
    </aside>
  </div>
</main>
