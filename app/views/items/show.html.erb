<main class="container">
    <section class="item-header">
      <h1><%=@item.name%></h1>
      <div class="meta">
        <span>existing_rating.score⭐ <%=@item.rating%></span>
        <a href="#">item.review</a>
        <%# <span>🥇 Supervendeur · <a href="#">Bordeaux, France</a></span> %>
      </div>
    </section>




    <%# <div class="gallery row">
      <div class="col-6">
      <%= cl_image_tag @item.image.key, class: "main-image object-fit-cover w-100" %>
      <%# </div> %>
      <%# <div class="main-image"><img src="nimbus-main.jpg" alt="nimbus" /></div> %>
      <%# <div class="thumbnails col-5"> %>
        <%# <%= cl_image_tag @item.image.key %>
        <%# <%= cl_image_tag @item.image.key %>
        <%# <%= cl_image_tag @item.image.key %>
        <%# <%= cl_image_tag @item.image.key %>
      <%# </div> %>
    <%# </div> %>




<%# RATING %>


<div data-controller="toggle-form" style="max-width: 250px;">
  <% existing_rating = @item.ratings.find_by(user: current_user) %>

  <% if existing_rating %>
    <p>note : <strong><%= existing_rating.score %></strong> / 10</p>
    <button class="btn btn-outline-secondary btn-sm" data-action="toggle-form#toggle">Modifier ma note</button>
  <% else %>
    <button class="btn btn-primary btn-sm" data-action="toggle-form#toggle">Donner une note</button>
  <% end %>

  <div data-toggle-form-target="form" class="mt-2 hidden">
    <%= simple_form_for([@item, Rating.new]) do |f| %>
      <%= f.input :score, as: :float,
                  label: "Votre note (0 à 10)",
                  input_html: { min: 0, max: 10, step: 0.5, class: "form-control" } %>
      <%= f.submit existing_rating ? "Modifier" : "Noter", class: "btn btn-success btn-sm mt-2" %>
    <% end %>
  </div>
</div>

<%# IMAGE GALLERY %>


    <div class="gallery">
      <div class="">
      <%= cl_image_tag @item.image.key, class: "main-image object-fit-cover w-100" %>
      </div>
      <%# <div class="main-image"><img src="nimbus-main.jpg" alt="nimbus" /></div> %>
      <div class="thumbnails col-5">
        <%= cl_image_tag @item.image.key, class: ""  %>
        <%= cl_image_tag @item.image.key, class: "" %>
        <%= cl_image_tag @item.image.key, class: "" %>
        <%= cl_image_tag @item.image.key, class: "" %>
      </div>
    </div>
    </main>


    <%# FORMULAIRE %>


<%# DESCRIPTION %>

<div class="container2">
    <section class="item-info">
      <h2><%=@item.description%></h2>
      <p>1 place · Poils de chameaux · bois de chêne · 0–75 KM</p>

      <div class="info-box"> 🪄 <%=@item.category.capitalize%> de niveau <%=@item.power%>  </div>
      <% if @item.category == "chaudron" %>
      <div class="info-box">✨ Peut aussi servir à faire une excellente soupe aux orties (avec ou sans sortilèges).</div>
      <% elsif @item.category == "balais" %>
      <div class="info-box">✨ Peut aussi servir à enlever la poussière</div>
      <% elsif @item.category == "baguette" %>
      <div class="info-box">✨ Peut aussi servir à mélanger le café… mais attention aux explosions.</div>
      <% elsif @item.category == "amulette" %>
      <div class="info-box">✨ Protège contre les malédictions… et les mauvais rencards.</div>
      <% elsif @item.category == "cape" %>
      <div class="info-box">✨ Peut aussi cacher une tenue douteuse en cas d'urgence fashion.</div>
      <% end %>


      <div class="description">
        <h3>Description</h3>
        <p><%=@item.long_description%></p>



<%# REVIEWS %>

<h2>Reviews</h2>

<% if @item.reviews.any? %>

    <% @item.reviews.each do |review| %>
<h5 class="font-weight-bold"> <%= review.user.name %></h5>


        <p><%= review.content %>  - <small> Il y a <%= time_ago_in_words(review.created_at) %> </small></span></p>

        <% if review.user_id == current_user.id %>
          <%= link_to "Delete review", review_path(review),
                data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this review?" },
                class: "btn btn-sm btn-danger" %>
        <% end %>
        

    <% end %>
  </ul>
<% else %>
  <p>No reviews yet</p>
<% end %>

</div>
    </section>



    <aside class="booking">
      <div class="price"> <%=@item.price%> / jour</div>
      <%# <span>⭐ <%= existing_rating.score %> ·
      <a href="#">7 commentaires</a></span>

      <form>
        <label>À partir du</label>
        <input type="date" />
        <label>Jusqu'au</label>
        <input type="date" />
        <button><%= link_to "Réserver",new_item_reservation_path(@item), class: "text-decoration-none text-white"%></button>

      </form>

      <div class="summary">
        <p>79€ × 7 jours — 555€</p>
        <p>Promotion — -28€</p>
        <p><strong>Total : 701€</strong></p>
        <small>Vous ne serez pas débité maintenant</small>
      </div>
    </aside>


    <%# BOUTONS %>

<%= link_to "Editer l'objet",edit_item_path(@item), class: "btn btn-secondary"%>

<%= link_to "Ajouter une review", new_item_review_path(@item), class: "btn btn-secondary" %>
<%= link_to "Supprimer l'objet",item_path(@item), data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this item?" }, class: "btn btn-secondary"%>




  </div>


<%# <% if @item.image.attached? %>
  <%# <%= cl_image_tag @item.image.key, height: 300, width: 400, crop: :fill %>
<%# <% end %>
