

<h1><%=@item.name%></h1>

<% if @item.image.attached? %>
  <%= cl_image_tag @item.image.key, height: 300, width: 400, crop: :fill %>
<% end %>



<p>Price: <%= number_to_currency(@item.price) %></p>
<p>Description: <%= @item.description %></p>
<p>Power: <%= @item.power %></p>
<p>Category: <%= @item.category %></p>

<h2>Reviews</h2>

<% if @item.reviews.any? %>
  <ul>
    <% @item.reviews.each do |review| %>
      <li>
        <strong><%= review.user.name %>:</strong>
        <%= review.content %> 
        <small><%= time_ago_in_words(review.created_at) %> ago</small>
        <%= link_to "Delete review", review_path(review),
              data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this review?" },
              class: "btn btn-sm btn-danger" %>
      </li>
      </li>
    <% end %>
  </ul>
<% else %>
  <p>No reviews yet.</p>
<% end %>


<div data-controller="toggle-form" style="max-width: 250px;">
  <% existing_rating = @item.ratings.find_by(user: current_user) %>

  <% if existing_rating %>
    <p>note : <strong><%= existing_rating.score %></strong> / 10</p>
    <button class="btn btn-outline-secondary btn-sm" data-action="toggle-form#toggle">Modifier ma note</button>
  <% else %>
    <button class="btn btn-primary btn-sm" data-action="toggle-form#toggle">Donner une note</button>
  <% end %>

  <div data-toggle-form-target="form" class="mt-2 hidden">
    <%= simple_form_for([@item, Rating.new]) do |f| %>
      <%= f.input :score, as: :float,
                  label: "Votre note (0 Ã  10)",
                  input_html: { min: 0, max: 10, step: 0.5, class: "form-control" } %>
      <%= f.submit existing_rating ? "Modifier" : "Noter", class: "btn btn-success btn-sm mt-2" %>
    <% end %>
  </div>
</div>


<%= link_to "Edit item",edit_item_path(@item), class: "btn btn-secondary"%>
<%= link_to "Add a review", new_item_review_path(@item), class: "btn btn-secondary" %>
<%= link_to 'Back to items', root_path, class: "btn btn-secondary" %>
<%= link_to "Delete",item_path(@item),
  data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, class: "btn btn-danger"
%>

<%= link_to "Reserve this item", new_item_reservation_path(@item), class: "btn btn-primary" %>
<%= link_to "Dashboard", dashboards_path, class: "btn btn-warning" %>
